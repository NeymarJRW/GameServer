{"remainingRequest":"/Users/mac/Desktop/茜茜公主/GameServer/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mac/Desktop/茜茜公主/GameServer/src/views/Manage/Games.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mac/Desktop/茜茜公主/GameServer/src/views/Manage/Games.vue","mtime":1560154275705},{"path":"/Users/mac/Desktop/茜茜公主/GameServer/node_modules/babel-loader/lib/index.js","mtime":1557114185618},{"path":"/Users/mac/Desktop/茜茜公主/GameServer/node_modules/cache-loader/dist/cjs.js","mtime":1558076220204},{"path":"/Users/mac/Desktop/茜茜公主/GameServer/node_modules/vue-loader/lib/index.js","mtime":1557114192616}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  mark,\r\n  problemReason,\r\n  gameIndex,\r\n  gameImgurl,\r\n  classIndex,\r\n  gameDelete,\r\n  labelIndex,\r\n  gameuploadUri,\r\n  gameUpdate,\r\n  zipuploadUrl,\r\n  judgeName,\r\n  onfocus,\r\n  onblur,\r\n  clear\r\n} from \"@/api/index\";\r\nimport axios from \"axios\";\r\nimport { setInterval, clearTimeout, setTimeout } from \"timers\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      pageindex:1,\r\n      clear:false,\r\n      markid:\"\",\r\n      btnAdd: true,\r\n      btnEdit: true,\r\n      totaldatalist: [],\r\n      datalist: [],\r\n      datacount: 0, //一共几条游戏\r\n      pagesize: 9, //分页\r\n      classList: [],\r\n      tagLists: [],\r\n      typeLists: [\r\n        { id: \"0\", name: \"游戏\" },\r\n        { id: \"1\", name: \"ios\" },\r\n        { id: \"2\", name: \"android\" }\r\n      ],\r\n      typeflag: true,\r\n      gametype: [], //游戏分类\r\n      showtype: [], //显示游戏分类\r\n      gametip: [], //游戏标签\r\n      showtip: [], //显示游戏标签\r\n      searchvalue: \"\", //搜索框的值\r\n      file: \"\",\r\n      zipfile: \"\",\r\n      zipfileUrl: \"\",\r\n      gameImgurl: \"\",\r\n      zipuploadUrl: \"\",\r\n      gameUpload: \"\",\r\n      gameuploadUri: \"\",\r\n      uploaded: false,\r\n      uploadtitle: \"已上传0%\",\r\n      marilynName: \"\",\r\n      marilynAlias: \"\",\r\n      marilynUrl: \"\",\r\n      marilynTag: \"\",\r\n      marilynType: \"\",\r\n      marilyndir: \"\",\r\n      marilyncom: \"\",\r\n      marilynnum: 1,\r\n      marilynSelect: \"\",\r\n      currentDelete: \"\",\r\n      deleteModel: false,\r\n      editModel: false,\r\n      modal_loading: false,\r\n      currentEdit: {},\r\n      marilynNewImg: \"\",\r\n      spinShow: true,\r\n      labelId: [],\r\n      typeId: [],\r\n      classId: \"\",\r\n      currentImg: null,\r\n      addCard: false,\r\n      dialogTableVisible: false,\r\n      formLabelWidth: '120px',\r\n      problemreason:[],\r\n      directionLists: [\r\n        {\r\n          value: \"0\",\r\n          name: \"竖屏\"\r\n        },\r\n        {\r\n          value: \"1\",\r\n          name: \"横屏\"\r\n        }\r\n      ],\r\n      commendLists: [\r\n        {\r\n          value: \"0\",\r\n          name: \"不推荐\"\r\n        },\r\n        {\r\n          value: \"1\",\r\n          name: \"推荐\"\r\n        }\r\n      ],\r\n      problemreason_value:[],\r\n      clear_value:[],\r\n      clearcon:[\r\n         {\r\n          value: \"index\",\r\n          content: \"首页\"\r\n        },\r\n         {\r\n          value: \"recommend\",\r\n          content: \"推荐\"\r\n        },\r\n         {\r\n          value: \"news\",\r\n          content: \"最新\"\r\n        },\r\n         {\r\n          value: \"hot\",\r\n          content: \"最热\"\r\n        },\r\n         {\r\n          value: \"class\",\r\n          content: \"分类推荐\"\r\n        },\r\n         {\r\n          value: \"label\",\r\n          content: \"标签推荐\"\r\n        },\r\n         {\r\n          value: \"all\",\r\n          content: \"全部缓存\"\r\n        },\r\n      ]\r\n    };\r\n  },\r\n  mounted() {\r\n    this.problemList();\r\n    var judgename_add = document\r\n      .querySelector(\".judgename_add\")\r\n      .querySelector(\"input\");\r\n    var judgename_edit = document\r\n      .querySelector(\".judgename_edit\")\r\n      .querySelector(\"input\");\r\n\r\n    onfocus(judgename_add, () => {\r\n      judgename_add.style.border = \"1px solid #2d8cf0\";\r\n      this.btnAdd = true;\r\n    });\r\n    onblur(judgename_add, () => {\r\n      judgeName({ name: this.marilynName, type: \"game\" }).then(res => {\r\n        if (res.state == 0) {\r\n          if (this.addCard) {\r\n            this.btnAdd = false;\r\n            this.$Message.error(\"名字为空或该名字已存在\");\r\n            judgename_add.style.border = \"1px solid red\";\r\n            setTimeout(() => {\r\n              judgename_add.style.border = \"1px solid #dcdee2\";\r\n            }, 2000);\r\n          }else{\r\n            this.btnAdd = true;\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n    onfocus(judgename_edit, () => {\r\n      judgename_edit.style.border = \"1px solid #2d8cf0\";\r\n      this.btnEdit = true;\r\n    });\r\n    onblur(judgename_edit, () => {\r\n      this.btnEdit = true;\r\n      judgeName({\r\n        name: this.currentEdit.name,\r\n        type: \"game\",\r\n        id: this.currentDelete\r\n      }).then(res => {\r\n        if (res.state == 0) {\r\n          if (this.editModel) {\r\n            this.btnEdit = false;\r\n            this.$Message.error(\"名字为空或该名字已存在\");\r\n            judgename_edit.style.border = \"1px solid red\";\r\n            setTimeout(() => {\r\n              judgename_edit.style.border = \"1px solid #dcdee2\";\r\n            }, 2000);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.zipuploadUrl = zipuploadUrl;\r\n    this.gameImgurl = gameImgurl;\r\n    this.gameuploadUri = gameuploadUri;\r\n    this.getData();\r\n    classIndex().then(res => {\r\n      if (res.state === \"1\") {\r\n        this.classList = res.msg;\r\n      }\r\n    });\r\n    labelIndex().then(res => {\r\n      if (res.state === \"1\") {\r\n        this.tagLists = res.msg;\r\n      }\r\n    });\r\n  },\r\n\r\n  methods: {\r\n \r\n    markclick(i){\r\n      this.markid = i.id\r\n    },\r\n    prolome(){\r\n      mark({\r\n        id:this.markid,tab:this.problemreason_value.join(\",\")}).then(res => {\r\n        console.log(res)\r\n        if(res.msg == \"标记成功！\"){\r\n          this.$message({\r\n          message: '标记成功',\r\n          type: 'success'\r\n        });\r\n        }else{\r\n           this.$message.error('标记失败');\r\n        }\r\n      })\r\n      this.getData()\r\n      this.dialogTableVisible = false\r\n    },\r\n      editEvent(e) {\r\n      this.labelId = [];\r\n      this.currentEdit = e;\r\n      this.editModel = true;\r\n      this.typeId = e.type;\r\n      // console.log(this.typeId);\r\n      for (var i = 0; i < e.label.length; i++) {\r\n        this.labelId.push(e.label[i].id);\r\n      }\r\n      this.classId = e.class.id;\r\n    },\r\n    getpage(res) {\r\n      this.totaldatalist = res;\r\n      this.datacount = this.totaldatalist.length;\r\n      if (this.datacount < this.pagesize) {\r\n        this.datalist = this.totaldatalist;\r\n      } else {\r\n        this.datalist = this.totaldatalist.slice(0, this.pagesize);\r\n      }\r\n    },\r\n    problemList(){\r\n      problemReason().then(\r\n        res =>{\r\n          console.log(res.msg)\r\n          // let arr = []\r\n          // for ( var i = 0; i <res.msg.length; i++){\r\n          //     arr.push(res.msg[i].content)\r\n          // }\r\n          // console.log(arr)\r\n           this.problemreason = res.msg\r\n        }\r\n      )\r\n    },\r\n    getData() {\r\n      this.spinShow = true;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          this.spinShow = false;\r\n          if (res.msg == \"数据为空！\") {\r\n            this.getpage(\"\");\r\n          } else {\r\n            var len = res.msg.length;\r\n            for (var i = 0; i < len; i++) {\r\n              //获取游戏分类\r\n              if (this.gametype.indexOf(res.msg[i].class.name) == -1) {\r\n                this.gametype.push(res.msg[i].class.name);\r\n              }\r\n              var tip_len = res.msg[i].label.length;\r\n              for (var j = 0; j < tip_len; j++) {\r\n                if (this.gametip.indexOf(res.msg[i].label[j].name) == -1) {\r\n                  this.gametip.push(res.msg[i].label[j].name);\r\n                }\r\n              }\r\n            }\r\n            this.getpage(res.msg);\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    //全部游戏列表\r\n    allgame() {\r\n      this.pageindex=1\r\n      gameIndex().then(res => {\r\n        this.showtype = [];\r\n        this.showtip = [];\r\n        if (res.state === \"1\") {\r\n          this.getpage(res.msg);\r\n          this.spinShow = false;\r\n        }\r\n      });\r\n    },\r\n\r\n    //选择分类\r\n    selecttype(i) {\r\n      this.pageindex=1\r\n      this.showtip = [];\r\n      this.showtype = i;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          var newarr = res.msg.filter(function(item) {\r\n            if (item.class.name == i) {\r\n              return item\r\n            }\r\n          });\r\n          this.getpage(newarr);\r\n        }\r\n      });\r\n    },\r\n\r\n    //选择标签\r\n    selecttip(i) {\r\n      this.pageindex=1\r\n      this.showtype = [];\r\n      this.showtip = i;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          var newarr= res.msg.filter(function(item) {\r\n            var len = item.label.length;\r\n            if (len > 0) {\r\n              for (var j = 0; j < len; j++) {\r\n                if (item.label[j].name == i) {\r\n                 return item\r\n                }\r\n              }\r\n            }\r\n          });\r\n          \r\n          this.getpage(newarr);\r\n        }\r\n      });\r\n    },\r\n\r\n    //搜索\r\n    search(val) {\r\n      this.pageindex=1\r\n      if (val) {\r\n        gameIndex().then(res => {\r\n          if (res.state === \"1\") {\r\n             var newarr =res.msg.filter(function(item) {\r\n              if (\r\n                item.name.indexOf(val) == 0 &&\r\n                item.name.length == val.length\r\n              ) {\r\n                return item\r\n              }\r\n            });\r\n            if (newarr.length > 0) {\r\n              this.getpage(newarr);\r\n            } else {\r\n              this.$Message.warning(\"没有找到匹配结果\");\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        this.$Message.warning(\"请输入搜索内容\");\r\n      }\r\n    },\r\n    changepage(index) {\r\n      var _start = (index - 1) * this.pagesize;\r\n      var _end = index * this.pagesize;\r\n      this.datalist = this.totaldatalist.slice(_start, _end);\r\n      var scrollTop =\r\n        document.documentElement.scrollTop || document.body.scrollTop;\r\n      this.$refs.marilyn_tab.scrollTop;\r\n    },\r\n    uploadSuccess(res, file) {},\r\n    handleUpload(file) {\r\n      var self = this;\r\n      var reader = new FileReader(),\r\n      img = new Image();\r\n      reader.readAsDataURL(file);\r\n      reader.onload = function(e) {\r\n        self.marilynNewImg = e.target.result;\r\n      };\r\n      this.file = file;\r\n    },\r\n    zipUpload(file) {\r\n      this.zipfileUrl = \"\";\r\n      var btn=document.querySelector('.btn')\r\n      var btn_edit=document.querySelector('.btn_edit')\r\n      \r\n      btn.disabled=true\r\n      btn_edit.disabled=true\r\n      var a = 0;\r\n      var jindu = setInterval(() => {\r\n        a++;\r\n        this.uploadtitle = \"已上传\" + a + \"%\";\r\n        if (this.zipfileUrl) {\r\n          this.uploadtitle = \"上传完成\";\r\n          btn.disabled=false\r\n          btn_edit.disabled=false\r\n\r\n          clearTimeout(jindu);\r\n        }\r\n        if (a == 99) {\r\n          clearTimeout(jindu);\r\n          var newtime = setInterval(() => {\r\n            this.uploadtitle = \"已上传99%\";\r\n            if (this.zipfileUrl) {\r\n              this.uploadtitle = \"上传完成\";\r\n              btn.disabled=false\r\n              btn_edit.disabled=false\r\n              clearTimeout(newtime);\r\n            }\r\n          }, 100);\r\n        }\r\n      }, 700);\r\n\r\n      if (file.type.indexOf(\"zip\") > -1) {\r\n        this.uploaded = true;\r\n        this.zipfile = file;\r\n        let data = new FormData();\r\n        const option = {\r\n          method: \"post\",\r\n          body: data\r\n        };\r\n        data.append(\"file\", this.zipfile);\r\n        fetch(zipuploadUrl, option)\r\n          .then(res => res.json())\r\n          .then(resJson => {\r\n            if (resJson.state === \"1\") {\r\n              this.zipfileUrl = resJson.msg;\r\n              //  console.log('上传 '+ this.zipfileUrl)\r\n            }\r\n          });\r\n      }\r\n    },\r\n    modifyUpload(e) {\r\n      var self = this;\r\n      this.currentImg = e.currentTarget.files[0];\r\n      var reader = new FileReader(),\r\n        img = new Image();\r\n      reader.readAsDataURL(this.currentImg);\r\n      reader.onload = function(e) {\r\n        // self.marilynAddImg = e.target.result\r\n        document.querySelector(\".curtimg\").src = e.target.result;\r\n      };\r\n    },\r\n    addGame() {\r\n      if (this.marilynType == \"0\") {\r\n        this.marilynUrl = this.zipfileUrl;\r\n      }\r\n      let data = new FormData();\r\n      data.append(\"file\", this.file);\r\n      data.append(\"name\", this.marilynName);\r\n      data.append(\"alias\", this.marilynAlias);\r\n      data.append(\"url\", this.marilynUrl);\r\n      data.append(\"cId\", this.marilynSelect);\r\n      if(this.marilynTag){\r\n        data.append(\"label\", this.marilynTag.join(\",\"));\r\n      }\r\n      data.append(\"type\", this.marilynType);\r\n      data.append(\"screen\", this.marilyndir);\r\n      data.append(\"recommend\", this.marilyncom);\r\n      data.append(\"weight\", this.marilynnum);\r\n      const option = {\r\n        method: \"post\",\r\n        body: data\r\n      };\r\n      fetch(gameuploadUri, option)\r\n        .then(res => res.json())\r\n        .then(resJson => {\r\n          if (resJson.state === \"1\") {\r\n            this.$Message.success(resJson.msg);\r\n            this.file = \"\";\r\n            this.marilynName = \"\";\r\n            this.marilynAlias = \"\";\r\n            this.marilynUrl = \"\";\r\n            this.marilynSelect = \"\";\r\n            this.marilynTag = \"\";\r\n            this.marilynNewImg = \"\";\r\n            this.getData();\r\n            this.addCard = false;\r\n          } else {\r\n            this.$Message.error(resJson.msg);\r\n          }\r\n        });\r\n    },\r\n    toolDelete() {\r\n      gameDelete({\r\n        id: this.currentDelete\r\n      }).then(res => {\r\n        if (res.state === \"1\") {\r\n          this.deleteModel = false;\r\n          this.$Message.success(res.msg);\r\n          this.getData();\r\n        } else {\r\n          this.$Message.error(res.msg);\r\n        }\r\n      });\r\n    },\r\n    toolEdit() {\r\n      let data = new FormData();\r\n      \r\n      if (this.currentImg) {\r\n        data.append(\"file\", this.currentImg);\r\n      }\r\n      data.append(\"id\", this.currentEdit.id);\r\n      data.append(\"name\", this.currentEdit.name);\r\n      data.append(\"alias\", this.currentEdit.alias);\r\n      data.append(\"cId\", this.classId);\r\n      data.append(\"label\", this.labelId.join(\",\"));\r\n      data.append(\"type\", this.typeId);\r\n       data.append(\"url\", this.currentEdit.url);\r\n      data.append(\"recommend\", this.currentEdit.recommend);\r\n      data.append(\"screen\", this.currentEdit.screen);\r\n      data.append(\"weight\", this.currentEdit.weight);\r\n      const option = {\r\n        method: \"post\",\r\n        body: data\r\n      };\r\n      fetch(gameUpdate, option)\r\n        .then(res => res.json())\r\n        .then(resJson => {\r\n          if (resJson.state === \"1\") {\r\n            this.editModel = false;\r\n            this.$Message.success(resJson.msg);\r\n            this.getData();\r\n          } else {\r\n            this.$Message.error(resJson.msg);\r\n          }\r\n        });\r\n    }\r\n  },\r\n  watch: {\r\n    marilynType(value) {\r\n      if (value != 0) {\r\n        document.querySelector(\".btn\").disabled = false;\r\n      } else {\r\n        if (this.uploadtitle != \"上传完成\") {\r\n          document.querySelector(\".btn\").disabled = true;\r\n        }\r\n      }\r\n    },\r\n    addCard(value) {\r\n      this.btnAdd = true;\r\n    },\r\n    editModel(value){\r\n      this.btnEdit = true;\r\n    },\r\n\r\n  }\r\n};\r\n",{"version":3,"sources":["Games.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Games.vue","sourceRoot":"src/views/Manage","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <Spin size=\"large\" fix v-if=\"spinShow\"></Spin>\r\n    <Button type=\"primary\" @click=\"allgame\" style=\"margin-left: 20px;\">全部游戏</Button>\r\n    <Dropdown style=\"margin-left: 20px;\">\r\n      <Button type=\"primary\" style=\"width:100px\">\r\n        {{showtype.length>0 ? showtype :'选择分类'}}\r\n        <Icon type=\"ios-arrow-down\"></Icon>\r\n      </Button>\r\n      <DropdownMenu slot=\"list\" class=\"xialai\">\r\n        <DropdownItem v-for=\"item in gametype\">\r\n          <span @click=\"selecttype(item)\">{{item}}</span>\r\n        </DropdownItem>\r\n      </DropdownMenu>\r\n    </Dropdown>\r\n    <Dropdown style=\"margin-left: 20px\">\r\n      <Button type=\"primary\" style=\"width:100px\">\r\n        {{showtip.length>0 ? showtip :'选择标签'}}\r\n        <Icon type=\"ios-arrow-down\"></Icon>\r\n      </Button>\r\n      <DropdownMenu slot=\"list\" class=\"xialai\">\r\n        <DropdownItem v-for=\"item in gametip\">\r\n          <span @click=\"selecttip(item)\">{{item}}</span>\r\n        </DropdownItem>\r\n      </DropdownMenu>\r\n    </Dropdown>\r\n    <Input\r\n      class=\"sousuo\"\r\n      :value=\"searchvalue\"\r\n      search\r\n      enter-button\r\n      placeholder=\"按游戏名搜索\"\r\n      @on-search=\"search\"\r\n    />\r\n\r\n    <div class=\"marilyn_tab\" ref=\"marilyn_tab\" id=\"totop\">\r\n      <Card class=\"marilyn_card marilyn_card_add\" ref=\"#top\">\r\n        <div class=\"add_game_view\" @click=\"addCard = true\">\r\n          <img src=\"../../images/add.png\" style=\"height:164px;width:164px\">\r\n          <span>添加游戏</span>\r\n        </div>\r\n      </Card>\r\n      <Card class=\"marilyn_card\" v-for=\"i in datalist\">\r\n        <div style=\"text-align:center\">\r\n          <img :src=\"gameImgurl + i.image\" class=\"marilyn_img\">\r\n          <p class=\"marilyn_des\">中文名称 : {{i.name}}</p>\r\n          <p class=\"marilyn_des\">英文名称 : {{i.alias}}</p>\r\n          <p class=\"marilyn_des\">游戏地址 : <a target=\"_Blank\" :href=\"i.type=='0' ? gameImgurl + i.url : i.url\">{{i.url}}</a></p>\r\n          <p class=\"marilyn_des\">创建时间 : {{i.time}}</p>\r\n          <p class=\"marilyn_des\">所属分类: {{i.class.name}}</p>\r\n          <p class=\"marilyn_des\">\r\n            所属标签 :\r\n            <template v-for=\"v in i.label\">{{v.name}},</template>\r\n          </p>\r\n          <p\r\n            class=\"marilyn_des\"\r\n          >游戏类型 : {{i.type ? (i.type==0 ? '游戏' : (i.type==1 ? 'ios' : 'android' ) ) : '未定义' }}</p>\r\n\r\n          <p class=\"marilyn_des\">\r\n            屏幕方向 :\r\n            <template v-if=\"i.screen == 0\">竖屏</template>\r\n            <template v-else>横屏</template>\r\n          </p>\r\n          <p class=\"marilyn_des\">\r\n            是否推荐 :\r\n            <template v-if=\"i.recommend == 0\">不推荐</template>\r\n            <template v-else>推荐</template>\r\n          </p>\r\n          <p class=\"marilyn_des\">游戏权重 : {{i.weight}}</p>\r\n          <p class=\"marilyn_des\">游戏标记问题 : {{i.weight}}</p>\r\n          <Button type=\"primary\" style=\"width:100px\" @click=\"markclick(i),dialogTableVisible = true\" >\r\n            标记\r\n          </Button>\r\n        \r\n        </div>\r\n        <div class=\"marilyn_tools\">\r\n          <i\r\n            class=\"fas fa-trash-alt\"\r\n            style=\"cursor:pointer;color:#ed4014\"\r\n            @click=\"currentDelete = i.id; deleteModel = !deleteModel\"\r\n          ></i>\r\n          <i class=\"far fa-edit\" style=\"cursor:pointer\" @click=\"editEvent(i)\"></i>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n    \r\n      <!-- <Modal v-model=\"clear\" width=\"480\" height=\"600\" style=\"width:400px\">\r\n             <p slot=\"header\" style=\"color:#2d8cf0;text-align:center\">\r\n                <span>清空缓存类型</span>\r\n              </p>\r\n             <Select\r\n              v-model=\"clear_value\"\r\n              multiple\r\n            >\r\n              <Option v-for=\"(item,index) in clearcon\" :value=\"item.value\" :key=\"index\">{{item.content}}</Option>\r\n            </Select>\r\n             <div slot=\"footer\">\r\n        <Button\r\n          v-show='btnEdit'\r\n          ref=\"btn_edit\"\r\n          class='btn_edit'\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          long\r\n          :loading=\"modal_loading\"\r\n \r\n        >确认</Button>\r\n  \r\n      </div>\r\n          </Modal> -->\r\n    <!-- problemreason -->\r\n          <Modal v-model=\"dialogTableVisible\" width=\"480\" height=\"600\" style=\"width:400px\">\r\n             <p slot=\"header\" style=\"color:#2d8cf0;text-align:center\">\r\n                <span>选择游戏问题类型</span>\r\n              </p>\r\n             <Select\r\n              v-model=\"problemreason_value\"\r\n              multiple\r\n            >\r\n              <Option v-for=\"(item,index) in problemreason\" :value=\"item.id\" :key=\"index\">{{item.content}}</Option>\r\n            </Select>\r\n             <div slot=\"footer\">\r\n        <Button\r\n          v-show='btnEdit'\r\n          ref=\"btn_edit\"\r\n          class='btn_edit'\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          long\r\n          :loading=\"modal_loading\"\r\n          @click=\"prolome\"\r\n        >确认</Button>\r\n  \r\n      </div>\r\n          </Modal>\r\n    <!-- 增加 -->\r\n    <Modal v-model=\"addCard\" width=\"480\" footer-hide>\r\n      <Card class=\"marilyn_card addgame\">\r\n        <div style=\"text-align:center\" class=\"marilyn_up_card\">\r\n          <Upload\r\n            style=\"margin:0 auto\"\r\n            multiple\r\n            type=\"drag\"\r\n            :action=\"gameUpload\"\r\n            name=\"file\"\r\n            :on-success=\"uploadSuccess\"\r\n            :show-upload-list=\"false\"\r\n            :format=\"['jpg','jpeg','png','gif']\"\r\n            :before-upload=\"handleUpload\"\r\n          >\r\n            <div style=\"padding: 20px 0;width:200px\">\r\n              <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\r\n              <p>单击或拖动图片到此处上传</p>\r\n            </div>\r\n            <img :src=\"marilynNewImg\" class=\"upload_image\" alt>\r\n          </Upload>\r\n\r\n          <div class=\"marilyn_margin\">\r\n            中文名称 :\r\n            <Input\r\n              class=\"judgename_add\"\r\n              prefix=\"ios-game-controller-b\"\r\n              placeholder=\"中文游戏名称 ...\"\r\n              style=\"width: 200px\"\r\n              v-model=\"marilynName\"\r\n            />\r\n          </div>\r\n          <div class=\"marilyn_margin\">\r\n            英文名称 :\r\n            <Input\r\n              prefix=\"ios-game-controller-b-outline\"\r\n              placeholder=\"英文游戏名称 ...\"\r\n              style=\"width: 200px\"\r\n              v-model=\"marilynAlias\"\r\n            />\r\n          </div>\r\n\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            style=\"display:flex;align-items: center;justify-content:center\"\r\n          >\r\n            所属分类 :\r\n            <Select v-model=\"marilynSelect\" style=\"width:186px;margin-left:6px;text-align: left;\">\r\n              <Option v-for=\"item in classList\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n            </Select>\r\n          </div>\r\n\r\n          <div class=\"marilyn_margin\">\r\n            所属标签 :\r\n            <Select\r\n              v-model=\"marilynTag\"\r\n              multiple\r\n              style=\"width:186px;margin-left:6px;text-align: left;\"\r\n            >\r\n              <Option v-for=\"item in tagLists\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n            </Select>\r\n          </div>\r\n          <div class=\"marilyn_margin\">\r\n            游戏类型 :\r\n            <Select v-model=\"marilynType\" style=\"width:186px;margin-left:6px;text-align: left;\">\r\n              <Option v-for=\"item in typeLists\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n            </Select>\r\n          </div>\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            v-show=\"marilynType== '1' ? true :(marilynType== '2' ? true :false )\"\r\n          >\r\n\r\n            所属地址 :\r\n            <Input\r\n              prefix=\"md-pricetags\"\r\n              placeholder=\"请输入游戏地址 ...\"\r\n              style=\"width: 200px\"\r\n              v-model=\"marilynUrl\"\r\n            />\r\n          </div>\r\n          <Upload\r\n            v-show=\"marilynType== '0' ? true :false\"\r\n            style=\"margin-top:15px;margin:15px auto\"\r\n            multiple\r\n            type=\"drag\"\r\n            :action=\"gameUpload\"\r\n            name=\"file\"\r\n            :on-success=\"uploadSuccess\"\r\n            :show-upload-list=\"false\"\r\n            :format=\"['zip']\"\r\n            :before-upload=\"zipUpload\"\r\n          >\r\n            <div style=\"padding: 20px 0;width:200px\">\r\n              <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\r\n              <p>\r\n                单击或拖动zip格式\r\n                <br>游戏压缩包到此处上传\r\n              </p>\r\n              <p v-if=\"uploaded\" style=\"margin-top:15px\">{{uploadtitle}}</p>\r\n            </div>\r\n          </Upload>\r\n\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            style=\"display:flex;align-items: center;justify-content:center\"\r\n          >\r\n            屏幕方向 :\r\n            <Select v-model=\"marilyndir\" style=\"width:186px;margin-left:6px;text-align: left;\">\r\n              <Option\r\n                v-for=\"item in directionLists\"\r\n                :value=\"item.value\"\r\n                :key=\"item.value\"\r\n              >{{ item.name }}</Option>\r\n            </Select>\r\n          </div>\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            style=\"display:flex;align-items: center;justify-content:center\"\r\n          >\r\n            是否推荐 :\r\n            <Select v-model=\"marilyncom\" style=\"width:186px;margin-left:6px;text-align: left;\">\r\n              <Option\r\n                v-for=\"item in commendLists\"\r\n                :value=\"item.value\"\r\n                :key=\"item.value\"\r\n              >{{ item.name }}</Option>\r\n            </Select>\r\n          </div>\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            style=\"display:flex;align-items: center;justify-content:center\"\r\n          >\r\n            <span style=\"padding-right:5px\">权重数值 :</span>\r\n            <Input type=\"text\" prefix=\"md-pie\" style=\"width: 200px\" v-model=\"marilynnum\"/>\r\n          </div>\r\n          <div\r\n            class=\"marilyn_margin\"\r\n            style=\"display:flex;align-items: center;justify-content:center\"\r\n          >\r\n            <span style=\"padding-right:5px;color:#b3b3b3\">*权重数值:1默认，正整数从大到小推荐</span>\r\n          </div>\r\n          <div class=\"marilyn_margin\">\r\n            <Button\r\n            v-show=\"btnAdd\"\r\n              ref=\"btn_add\"\r\n              class=\"btn\"\r\n              type=\"primary\"\r\n              @click=\"addGame\"\r\n              style=\"width: 200px\"\r\n            >添加</Button>\r\n            <Button\r\n            v-show=\"!btnAdd\"\r\n              disabled\r\n              class=\"btn\"\r\n              type=\"primary\"\r\n              @click=\"addGame\"\r\n              style=\"width: 200px\"\r\n            >添加</Button>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </Modal>\r\n    <!-- 删除 -->\r\n    <Modal v-model=\"deleteModel\" width=\"360\">\r\n      <p slot=\"header\" style=\"color:#f60;text-align:center\">\r\n        <Icon type=\"ios-information-circle\"></Icon>\r\n        <span>删除确认</span>\r\n      </p>\r\n      <div style=\"text-align:center\">\r\n        <p>确认删除游戏</p>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <Button type=\"error\" size=\"large\" long :loading=\"modal_loading\" @click=\"toolDelete\">删除</Button>\r\n      </div>\r\n    </Modal>\r\n    <!-- 修改 -->\r\n    <Modal v-model=\"editModel\" width=\"480\">\r\n      <p slot=\"header\" style=\"color:#2d8cf0;text-align:center\">\r\n        <span>修改</span>\r\n      </p>\r\n      <div style=\"text-align:center\">\r\n        <div style=\"position:relative;display:flex;justify-content:center\" >\r\n          <input type=\"file\" class=\"inputfile\" name=\"file\" @change=\"modifyUpload\" id=\"fileImg\">\r\n          <img\r\n            :src=\"currentEdit.thumbnail ? gameImgurl + currentEdit.thumbnail : '' \"\r\n            alt\r\n            style=\"width:50px;height:50px;display:block;\"\r\n            class=\"curtimg\"\r\n          >\r\n        </div>\r\n        <div>\r\n          中文名称 : &nbsp;&nbsp;\r\n          <Input\r\n            class=\"judgename_edit\"\r\n            prefix=\"ios-game-controller-b\"\r\n            placeholder=\"游戏中文名称 ...\"\r\n            style=\"width:200px;margin:5px 0\"\r\n            v-model=\"currentEdit.name\"\r\n          />\r\n        </div>\r\n        <div>\r\n          英文名称 : &nbsp;&nbsp;\r\n          <Input\r\n            prefix=\"ios-game-controller-b-outline\"\r\n            placeholder=\"游戏英文名称 ...\"\r\n            style=\"width:200px;margin:5px 0\"\r\n            v-model=\"currentEdit.alias\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          所属分类 :\r\n          <Select\r\n            prefix=\"logo-buffer\"\r\n            v-model=\"classId\"\r\n            placeholder=\"所属游戏分类 ...\"\r\n            style=\"width:200px;text-align: left;margin-left:6px;margin-bottom:5px;margin-top:5px\"\r\n          >\r\n            <Option v-for=\"item in classList\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          所属标签 :\r\n          <Select\r\n            v-model=\"labelId\"\r\n            multiple\r\n            style=\"width:200px;margin-left:6px;text-align: left;margin-top:5px\"\r\n          >\r\n            <Option v-for=\"item in tagLists\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          游戏类型 :\r\n          <Select\r\n            v-model=\"typeId\"\r\n            style=\"width:200px;margin-left:6px;text-align: left;margin-top:5px\"\r\n          >\r\n            <Option v-for=\"item in typeLists\" :value=\"item.id\" :key=\"item.id\">{{ item.name }}</Option>\r\n          </Select>\r\n        </div>\r\n        <div\r\n          v-show=\"typeId== '1' ? true :(typeId== '2' ? true :false) \" \r\n        >\r\n          所属地址 : &nbsp;&nbsp;\r\n          <Input\r\n            prefix=\"md-pricetags\"\r\n            placeholder=\"所属游戏地址 ...\"\r\n            style=\"width:200px;margin:5px 0\"\r\n            v-model=\"currentEdit.url\"\r\n          />\r\n        </div>\r\n        <Upload\r\n            v-show=\"typeId== '0' ? true :false\"\r\n            style=\"margin:15px auto;width:200px\"\r\n            multiple\r\n            type=\"drag\"\r\n            :action=\"gameUpload\"\r\n            name=\"file\"\r\n            :on-success=\"uploadSuccess\"\r\n            :show-upload-list=\"false\"\r\n            :format=\"['zip']\"\r\n            :before-upload=\"zipUpload\"\r\n          >\r\n            <div style=\"padding: 20px 0;width:200px\">\r\n              <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\r\n              <p>\r\n                单击或拖动zip格式\r\n                <br>游戏压缩包到此处上传\r\n              </p>\r\n              <p v-if=\"uploaded\" style=\"margin-top:15px\">{{uploadtitle}}</p>\r\n            </div>\r\n          </Upload>\r\n        <div>\r\n          屏幕方向 :\r\n          <Select\r\n            v-model=\"currentEdit.screen\"\r\n            style=\"width:200px;margin-left:6px;text-align: left;margin-top:5px\"\r\n          >\r\n            <Option\r\n              v-for=\"item in directionLists\"\r\n              :value=\"item.value\"\r\n              :key=\"item.value\"\r\n            >{{ item.name }}</Option>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          是否推荐 :\r\n          <Select\r\n            v-model=\"currentEdit.recommend\"\r\n            style=\"width:200px;margin-left:6px;text-align: left;margin-top:5px\"\r\n          >\r\n            <Option\r\n              v-for=\"item in commendLists\"\r\n              :value=\"item.value\"\r\n              :key=\"item.value\"\r\n            >{{ item.name }}</Option>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          权重数值 :\r\n          <Input\r\n            type=\"text\"\r\n            prefix=\"md-pie\"\r\n            style=\"width:200px;margin-left:6px;text-align: left;margin-top:5px\"\r\n            v-model=\"currentEdit.weight\"\r\n          />\r\n          <p style=\"font-size:12px;color:#b3b3b3;padding-left:50px\">*1默认，正整数从大到小推荐</p>\r\n        </div>\r\n      </div>\r\n      <div slot=\"footer\">\r\n        <Button\r\n          v-show='btnEdit'\r\n          ref=\"btn_edit\"\r\n          class='btn_edit'\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          long\r\n          :loading=\"modal_loading\"\r\n          @click=\"toolEdit\"\r\n        >确认</Button>\r\n         <Button\r\n          v-show='!btnEdit'\r\n          disabled\r\n          ref=\"btn_edit\"\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          long\r\n          :loading=\"modal_loading\"\r\n          @click=\"toolEdit\"\r\n        >确认</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n    <!-- MODAL↑-->\r\n     <Page\r\n      :total=\"datacount\"\r\n      :page-size=\"pagesize\"\r\n      :current.sync='pageindex'\r\n      @on-change=\"changepage\"\r\n      show-elevator\r\n      class=\"page\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  mark,\r\n  problemReason,\r\n  gameIndex,\r\n  gameImgurl,\r\n  classIndex,\r\n  gameDelete,\r\n  labelIndex,\r\n  gameuploadUri,\r\n  gameUpdate,\r\n  zipuploadUrl,\r\n  judgeName,\r\n  onfocus,\r\n  onblur,\r\n  clear\r\n} from \"@/api/index\";\r\nimport axios from \"axios\";\r\nimport { setInterval, clearTimeout, setTimeout } from \"timers\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      pageindex:1,\r\n      clear:false,\r\n      markid:\"\",\r\n      btnAdd: true,\r\n      btnEdit: true,\r\n      totaldatalist: [],\r\n      datalist: [],\r\n      datacount: 0, //一共几条游戏\r\n      pagesize: 9, //分页\r\n      classList: [],\r\n      tagLists: [],\r\n      typeLists: [\r\n        { id: \"0\", name: \"游戏\" },\r\n        { id: \"1\", name: \"ios\" },\r\n        { id: \"2\", name: \"android\" }\r\n      ],\r\n      typeflag: true,\r\n      gametype: [], //游戏分类\r\n      showtype: [], //显示游戏分类\r\n      gametip: [], //游戏标签\r\n      showtip: [], //显示游戏标签\r\n      searchvalue: \"\", //搜索框的值\r\n      file: \"\",\r\n      zipfile: \"\",\r\n      zipfileUrl: \"\",\r\n      gameImgurl: \"\",\r\n      zipuploadUrl: \"\",\r\n      gameUpload: \"\",\r\n      gameuploadUri: \"\",\r\n      uploaded: false,\r\n      uploadtitle: \"已上传0%\",\r\n      marilynName: \"\",\r\n      marilynAlias: \"\",\r\n      marilynUrl: \"\",\r\n      marilynTag: \"\",\r\n      marilynType: \"\",\r\n      marilyndir: \"\",\r\n      marilyncom: \"\",\r\n      marilynnum: 1,\r\n      marilynSelect: \"\",\r\n      currentDelete: \"\",\r\n      deleteModel: false,\r\n      editModel: false,\r\n      modal_loading: false,\r\n      currentEdit: {},\r\n      marilynNewImg: \"\",\r\n      spinShow: true,\r\n      labelId: [],\r\n      typeId: [],\r\n      classId: \"\",\r\n      currentImg: null,\r\n      addCard: false,\r\n      dialogTableVisible: false,\r\n      formLabelWidth: '120px',\r\n      problemreason:[],\r\n      directionLists: [\r\n        {\r\n          value: \"0\",\r\n          name: \"竖屏\"\r\n        },\r\n        {\r\n          value: \"1\",\r\n          name: \"横屏\"\r\n        }\r\n      ],\r\n      commendLists: [\r\n        {\r\n          value: \"0\",\r\n          name: \"不推荐\"\r\n        },\r\n        {\r\n          value: \"1\",\r\n          name: \"推荐\"\r\n        }\r\n      ],\r\n      problemreason_value:[],\r\n      clear_value:[],\r\n      clearcon:[\r\n         {\r\n          value: \"index\",\r\n          content: \"首页\"\r\n        },\r\n         {\r\n          value: \"recommend\",\r\n          content: \"推荐\"\r\n        },\r\n         {\r\n          value: \"news\",\r\n          content: \"最新\"\r\n        },\r\n         {\r\n          value: \"hot\",\r\n          content: \"最热\"\r\n        },\r\n         {\r\n          value: \"class\",\r\n          content: \"分类推荐\"\r\n        },\r\n         {\r\n          value: \"label\",\r\n          content: \"标签推荐\"\r\n        },\r\n         {\r\n          value: \"all\",\r\n          content: \"全部缓存\"\r\n        },\r\n      ]\r\n    };\r\n  },\r\n  mounted() {\r\n    this.problemList();\r\n    var judgename_add = document\r\n      .querySelector(\".judgename_add\")\r\n      .querySelector(\"input\");\r\n    var judgename_edit = document\r\n      .querySelector(\".judgename_edit\")\r\n      .querySelector(\"input\");\r\n\r\n    onfocus(judgename_add, () => {\r\n      judgename_add.style.border = \"1px solid #2d8cf0\";\r\n      this.btnAdd = true;\r\n    });\r\n    onblur(judgename_add, () => {\r\n      judgeName({ name: this.marilynName, type: \"game\" }).then(res => {\r\n        if (res.state == 0) {\r\n          if (this.addCard) {\r\n            this.btnAdd = false;\r\n            this.$Message.error(\"名字为空或该名字已存在\");\r\n            judgename_add.style.border = \"1px solid red\";\r\n            setTimeout(() => {\r\n              judgename_add.style.border = \"1px solid #dcdee2\";\r\n            }, 2000);\r\n          }else{\r\n            this.btnAdd = true;\r\n          }\r\n        }\r\n      });\r\n    });\r\n    \r\n    onfocus(judgename_edit, () => {\r\n      judgename_edit.style.border = \"1px solid #2d8cf0\";\r\n      this.btnEdit = true;\r\n    });\r\n    onblur(judgename_edit, () => {\r\n      this.btnEdit = true;\r\n      judgeName({\r\n        name: this.currentEdit.name,\r\n        type: \"game\",\r\n        id: this.currentDelete\r\n      }).then(res => {\r\n        if (res.state == 0) {\r\n          if (this.editModel) {\r\n            this.btnEdit = false;\r\n            this.$Message.error(\"名字为空或该名字已存在\");\r\n            judgename_edit.style.border = \"1px solid red\";\r\n            setTimeout(() => {\r\n              judgename_edit.style.border = \"1px solid #dcdee2\";\r\n            }, 2000);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.zipuploadUrl = zipuploadUrl;\r\n    this.gameImgurl = gameImgurl;\r\n    this.gameuploadUri = gameuploadUri;\r\n    this.getData();\r\n    classIndex().then(res => {\r\n      if (res.state === \"1\") {\r\n        this.classList = res.msg;\r\n      }\r\n    });\r\n    labelIndex().then(res => {\r\n      if (res.state === \"1\") {\r\n        this.tagLists = res.msg;\r\n      }\r\n    });\r\n  },\r\n\r\n  methods: {\r\n \r\n    markclick(i){\r\n      this.markid = i.id\r\n    },\r\n    prolome(){\r\n      mark({\r\n        id:this.markid,tab:this.problemreason_value.join(\",\")}).then(res => {\r\n        console.log(res)\r\n        if(res.msg == \"标记成功！\"){\r\n          this.$message({\r\n          message: '标记成功',\r\n          type: 'success'\r\n        });\r\n        }else{\r\n           this.$message.error('标记失败');\r\n        }\r\n      })\r\n      this.getData()\r\n      this.dialogTableVisible = false\r\n    },\r\n      editEvent(e) {\r\n      this.labelId = [];\r\n      this.currentEdit = e;\r\n      this.editModel = true;\r\n      this.typeId = e.type;\r\n      // console.log(this.typeId);\r\n      for (var i = 0; i < e.label.length; i++) {\r\n        this.labelId.push(e.label[i].id);\r\n      }\r\n      this.classId = e.class.id;\r\n    },\r\n    getpage(res) {\r\n      this.totaldatalist = res;\r\n      this.datacount = this.totaldatalist.length;\r\n      if (this.datacount < this.pagesize) {\r\n        this.datalist = this.totaldatalist;\r\n      } else {\r\n        this.datalist = this.totaldatalist.slice(0, this.pagesize);\r\n      }\r\n    },\r\n    problemList(){\r\n      problemReason().then(\r\n        res =>{\r\n          console.log(res.msg)\r\n          // let arr = []\r\n          // for ( var i = 0; i <res.msg.length; i++){\r\n          //     arr.push(res.msg[i].content)\r\n          // }\r\n          // console.log(arr)\r\n           this.problemreason = res.msg\r\n        }\r\n      )\r\n    },\r\n    getData() {\r\n      this.spinShow = true;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          this.spinShow = false;\r\n          if (res.msg == \"数据为空！\") {\r\n            this.getpage(\"\");\r\n          } else {\r\n            var len = res.msg.length;\r\n            for (var i = 0; i < len; i++) {\r\n              //获取游戏分类\r\n              if (this.gametype.indexOf(res.msg[i].class.name) == -1) {\r\n                this.gametype.push(res.msg[i].class.name);\r\n              }\r\n              var tip_len = res.msg[i].label.length;\r\n              for (var j = 0; j < tip_len; j++) {\r\n                if (this.gametip.indexOf(res.msg[i].label[j].name) == -1) {\r\n                  this.gametip.push(res.msg[i].label[j].name);\r\n                }\r\n              }\r\n            }\r\n            this.getpage(res.msg);\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    //全部游戏列表\r\n    allgame() {\r\n      this.pageindex=1\r\n      gameIndex().then(res => {\r\n        this.showtype = [];\r\n        this.showtip = [];\r\n        if (res.state === \"1\") {\r\n          this.getpage(res.msg);\r\n          this.spinShow = false;\r\n        }\r\n      });\r\n    },\r\n\r\n    //选择分类\r\n    selecttype(i) {\r\n      this.pageindex=1\r\n      this.showtip = [];\r\n      this.showtype = i;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          var newarr = res.msg.filter(function(item) {\r\n            if (item.class.name == i) {\r\n              return item\r\n            }\r\n          });\r\n          this.getpage(newarr);\r\n        }\r\n      });\r\n    },\r\n\r\n    //选择标签\r\n    selecttip(i) {\r\n      this.pageindex=1\r\n      this.showtype = [];\r\n      this.showtip = i;\r\n      gameIndex().then(res => {\r\n        if (res.state === \"1\") {\r\n          var newarr= res.msg.filter(function(item) {\r\n            var len = item.label.length;\r\n            if (len > 0) {\r\n              for (var j = 0; j < len; j++) {\r\n                if (item.label[j].name == i) {\r\n                 return item\r\n                }\r\n              }\r\n            }\r\n          });\r\n          \r\n          this.getpage(newarr);\r\n        }\r\n      });\r\n    },\r\n\r\n    //搜索\r\n    search(val) {\r\n      this.pageindex=1\r\n      if (val) {\r\n        gameIndex().then(res => {\r\n          if (res.state === \"1\") {\r\n             var newarr =res.msg.filter(function(item) {\r\n              if (\r\n                item.name.indexOf(val) == 0 &&\r\n                item.name.length == val.length\r\n              ) {\r\n                return item\r\n              }\r\n            });\r\n            if (newarr.length > 0) {\r\n              this.getpage(newarr);\r\n            } else {\r\n              this.$Message.warning(\"没有找到匹配结果\");\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        this.$Message.warning(\"请输入搜索内容\");\r\n      }\r\n    },\r\n    changepage(index) {\r\n      var _start = (index - 1) * this.pagesize;\r\n      var _end = index * this.pagesize;\r\n      this.datalist = this.totaldatalist.slice(_start, _end);\r\n      var scrollTop =\r\n        document.documentElement.scrollTop || document.body.scrollTop;\r\n      this.$refs.marilyn_tab.scrollTop;\r\n    },\r\n    uploadSuccess(res, file) {},\r\n    handleUpload(file) {\r\n      var self = this;\r\n      var reader = new FileReader(),\r\n      img = new Image();\r\n      reader.readAsDataURL(file);\r\n      reader.onload = function(e) {\r\n        self.marilynNewImg = e.target.result;\r\n      };\r\n      this.file = file;\r\n    },\r\n    zipUpload(file) {\r\n      this.zipfileUrl = \"\";\r\n      var btn=document.querySelector('.btn')\r\n      var btn_edit=document.querySelector('.btn_edit')\r\n      \r\n      btn.disabled=true\r\n      btn_edit.disabled=true\r\n      var a = 0;\r\n      var jindu = setInterval(() => {\r\n        a++;\r\n        this.uploadtitle = \"已上传\" + a + \"%\";\r\n        if (this.zipfileUrl) {\r\n          this.uploadtitle = \"上传完成\";\r\n          btn.disabled=false\r\n          btn_edit.disabled=false\r\n\r\n          clearTimeout(jindu);\r\n        }\r\n        if (a == 99) {\r\n          clearTimeout(jindu);\r\n          var newtime = setInterval(() => {\r\n            this.uploadtitle = \"已上传99%\";\r\n            if (this.zipfileUrl) {\r\n              this.uploadtitle = \"上传完成\";\r\n              btn.disabled=false\r\n              btn_edit.disabled=false\r\n              clearTimeout(newtime);\r\n            }\r\n          }, 100);\r\n        }\r\n      }, 700);\r\n\r\n      if (file.type.indexOf(\"zip\") > -1) {\r\n        this.uploaded = true;\r\n        this.zipfile = file;\r\n        let data = new FormData();\r\n        const option = {\r\n          method: \"post\",\r\n          body: data\r\n        };\r\n        data.append(\"file\", this.zipfile);\r\n        fetch(zipuploadUrl, option)\r\n          .then(res => res.json())\r\n          .then(resJson => {\r\n            if (resJson.state === \"1\") {\r\n              this.zipfileUrl = resJson.msg;\r\n              //  console.log('上传 '+ this.zipfileUrl)\r\n            }\r\n          });\r\n      }\r\n    },\r\n    modifyUpload(e) {\r\n      var self = this;\r\n      this.currentImg = e.currentTarget.files[0];\r\n      var reader = new FileReader(),\r\n        img = new Image();\r\n      reader.readAsDataURL(this.currentImg);\r\n      reader.onload = function(e) {\r\n        // self.marilynAddImg = e.target.result\r\n        document.querySelector(\".curtimg\").src = e.target.result;\r\n      };\r\n    },\r\n    addGame() {\r\n      if (this.marilynType == \"0\") {\r\n        this.marilynUrl = this.zipfileUrl;\r\n      }\r\n      let data = new FormData();\r\n      data.append(\"file\", this.file);\r\n      data.append(\"name\", this.marilynName);\r\n      data.append(\"alias\", this.marilynAlias);\r\n      data.append(\"url\", this.marilynUrl);\r\n      data.append(\"cId\", this.marilynSelect);\r\n      if(this.marilynTag){\r\n        data.append(\"label\", this.marilynTag.join(\",\"));\r\n      }\r\n      data.append(\"type\", this.marilynType);\r\n      data.append(\"screen\", this.marilyndir);\r\n      data.append(\"recommend\", this.marilyncom);\r\n      data.append(\"weight\", this.marilynnum);\r\n      const option = {\r\n        method: \"post\",\r\n        body: data\r\n      };\r\n      fetch(gameuploadUri, option)\r\n        .then(res => res.json())\r\n        .then(resJson => {\r\n          if (resJson.state === \"1\") {\r\n            this.$Message.success(resJson.msg);\r\n            this.file = \"\";\r\n            this.marilynName = \"\";\r\n            this.marilynAlias = \"\";\r\n            this.marilynUrl = \"\";\r\n            this.marilynSelect = \"\";\r\n            this.marilynTag = \"\";\r\n            this.marilynNewImg = \"\";\r\n            this.getData();\r\n            this.addCard = false;\r\n          } else {\r\n            this.$Message.error(resJson.msg);\r\n          }\r\n        });\r\n    },\r\n    toolDelete() {\r\n      gameDelete({\r\n        id: this.currentDelete\r\n      }).then(res => {\r\n        if (res.state === \"1\") {\r\n          this.deleteModel = false;\r\n          this.$Message.success(res.msg);\r\n          this.getData();\r\n        } else {\r\n          this.$Message.error(res.msg);\r\n        }\r\n      });\r\n    },\r\n    toolEdit() {\r\n      let data = new FormData();\r\n      \r\n      if (this.currentImg) {\r\n        data.append(\"file\", this.currentImg);\r\n      }\r\n      data.append(\"id\", this.currentEdit.id);\r\n      data.append(\"name\", this.currentEdit.name);\r\n      data.append(\"alias\", this.currentEdit.alias);\r\n      data.append(\"cId\", this.classId);\r\n      data.append(\"label\", this.labelId.join(\",\"));\r\n      data.append(\"type\", this.typeId);\r\n       data.append(\"url\", this.currentEdit.url);\r\n      data.append(\"recommend\", this.currentEdit.recommend);\r\n      data.append(\"screen\", this.currentEdit.screen);\r\n      data.append(\"weight\", this.currentEdit.weight);\r\n      const option = {\r\n        method: \"post\",\r\n        body: data\r\n      };\r\n      fetch(gameUpdate, option)\r\n        .then(res => res.json())\r\n        .then(resJson => {\r\n          if (resJson.state === \"1\") {\r\n            this.editModel = false;\r\n            this.$Message.success(resJson.msg);\r\n            this.getData();\r\n          } else {\r\n            this.$Message.error(resJson.msg);\r\n          }\r\n        });\r\n    }\r\n  },\r\n  watch: {\r\n    marilynType(value) {\r\n      if (value != 0) {\r\n        document.querySelector(\".btn\").disabled = false;\r\n      } else {\r\n        if (this.uploadtitle != \"上传完成\") {\r\n          document.querySelector(\".btn\").disabled = true;\r\n        }\r\n      }\r\n    },\r\n    addCard(value) {\r\n      this.btnAdd = true;\r\n    },\r\n    editModel(value){\r\n      this.btnEdit = true;\r\n    },\r\n\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n.container {\r\n  padding-top: 20px;\r\n}\r\n\r\n.marilyn_tab {\r\n  padding-bottom: 5.333333rem; /* 200/37.5 */\r\n  margin-top: 20px;\r\n}\r\n\r\n.marilyn_card_add {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.addgame {\r\n  width: 100%;\r\n}\r\n\r\n.add_game_view {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n}\r\n\r\n.marilyn_tools {\r\n  margin-top: 20px;\r\n}\r\n\r\n.upload_image {\r\n  position: absolute;\r\n  top: 0;\r\n  height: 100%;\r\n}\r\n\r\n.inputfile {\r\n  height: 164px;\r\n  width: 164px;\r\n  position: absolute;\r\n  top: 0;\r\n  opacity: 0;\r\n}\r\n\r\n.curtimg {\r\n  height: 164px;\r\n  width: 164px;\r\n}\r\n\r\n.page {\r\n  text-align: center;\r\n  width: calc(100% - 16rem /* 600/37.5 */);\r\n  padding: 0.8rem /* 30/37.5 */ /* 20/37.5 */ 0;\r\n  background: rgb(240, 242, 245);\r\n  position: fixed;\r\n  bottom: 0;\r\n}\r\n\r\n.xialai span {\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.sousuo {\r\n  position: absolute;\r\n  top: 20px;\r\n  width: 200px;\r\n  left: 360px;\r\n}\r\n</style>\r\n\r\n"]}]}